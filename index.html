<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fedoform ‚Äî AI Economy & Family</title>
    <style>
        :root { --primary: #0084ff; --bg: #f0f2f5; --card: #ffffff; --text: #1c1e21; --accent: #ff4757; --gold: #ffc107; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; color: var(--text); }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar { width: 300px; background: var(--card); border-right: 1px solid #ddd; padding: 25px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; }
        .logo-box { display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px; }
        .logo-text { font-size: 28px; font-weight: 900; color: var(--primary); letter-spacing: -1.5px; }
        .logo-text span { color: #333; }

        .nav-item { padding: 12px 15px; border-radius: 10px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; font-weight: 500; }
        .nav-item:hover { background: #f2f3f5; }
        .nav-item.active { background: #e7f3ff; color: var(--primary); font-weight: bold; }

        .btn-main { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; }
        
        /* –ü—Ä–æ—Ñ–∏–ª—å –∏ –≠–∫–æ–Ω–æ–º–∏–∫–∞ */
        .coin-balance { background: #fff3cd; color: #856404; padding: 5px 12px; border-radius: 15px; font-weight: bold; font-size: 0.8rem; border: 1px solid #ffeeba; display: inline-block; }
        .profile-card { background: white; border-radius: 20px; padding: 30px; width: 100%; text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .family-tag { background: #fff0f6; color: #d63384; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; margin: 10px 0; border: 1px solid #ffdeeb; }
        .gift-grid { display: flex; justify-content: center; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        .gift-box { font-size: 1.5rem; background: #f8f9fa; border: 1px dashed #ccc; border-radius: 10px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; }
        .market { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px; }
        .market-item { border: 1px solid #eee; padding: 10px; border-radius: 12px; font-size: 0.8rem; }

        /* –ü–æ—Å—Ç—ã */
        .main-content { flex-grow: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; align-items: center; }
        .feed { width: 100%; max-width: 580px; }
        .post { background: var(--card); border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #efefef; }
        .post-img { width: calc(100% + 40px); margin: 15px -20px; max-height: 400px; object-fit: cover; }
        .comment { background: #f8f9fa; padding: 8px 12px; border-radius: 10px; margin-bottom: 5px; font-size: 0.85rem; border: 1px solid #eee; }

        /* –ú–æ–¥–∞–ª–∫–∏ –∏ –ò–ò */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 320px; text-align: center; }
        #ai-bot { position: fixed; bottom: 20px; right: 20px; background: #1a1a1a; color: white; padding: 15px; border-radius: 15px; width: 240px; display: none; border-left: 5px solid var(--primary); z-index: 3000; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-box" onclick="showFeed()">
        <svg width="35" height="35" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="#0084ff"/><path d="M35 25H65V35H45V45H60V55H45V75H35V25Z" fill="white"/><circle cx="70" cy="70" r="10" fill="#333" stroke="white" stroke-width="3"/></svg>
        <div class="logo-text">Fedo<span>form</span></div>
    </div>
    
    <div id="authArea"><button class="btn-main" onclick="openAuth()">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button></div>
    <div id="userArea" style="display:none" onclick="showProfile()" style="cursor:pointer">
        <div style="background:#f8f9fa; padding:12px; border-radius:12px; border:1px solid #eee;">
            <div id="uName" style="font-weight:bold; color:var(--primary);">üë§ –ù–∏–∫</div>
            <div id="uCoins" class="coin-balance">üí∞ 0</div>
            <button onclick="event.stopPropagation(); logout()" style="color:red; border:none; background:none; cursor:pointer; font-size:11px; margin-top:5px; display:block;">–í—ã—Ö–æ–¥</button>
        </div>
    </div>

    <div class="section-title">–†–∞–∑–¥–µ–ª—ã</div>
    <div id="topicsList"></div>
    <button onclick="createTopic()" style="background:none; border:none; color:var(--primary); cursor:pointer; font-weight:600; padding:10px;">+ –ù–æ–≤–∞—è —Ç–µ–º–∞</button>
    
    <div class="section-title">–°–∏—Å—Ç–µ–º–∞</div>
    <div class="nav-item" onclick="showFeed()">üè† –õ–µ–Ω—Ç–∞</div>
    <div class="nav-item" onclick="showChat()">ü§ñ Fedo AI –ß–∞—Ç</div>
</div>

<div class="main-content">
    <div class="feed" id="wallCont">
        <div id="editor" style="display:none" class="post">
            <textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?" rows="2"></textarea>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <label style="cursor:pointer; color:var(--primary); font-weight:600;">üì∑ –§–æ—Ç–æ <input type="file" id="fileInp" hidden onchange="prevImg()"></label>
                <button class="btn-main" style="width:auto; padding:8px 20px;" onclick="addPost()">–ü–æ—Å—Ç</button>
            </div>
            <img id="imgPreview" style="width:100%; display:none; border-radius:10px; margin-top:10px;">
        </div>
        <div id="wall"></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <h2 id="mTitle">–í—Ö–æ–¥</h2>
        <input type="text" id="regName" placeholder="–í–∞—à –Ω–∏–∫">
        <div id="aiInp" style="display:none"><input type="text" id="aiCodeInp" placeholder="–ö–æ–¥ –æ—Ç –ò–ò"></div>
        <button class="btn-main" id="authBtn" onclick="askCode()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
    </div>
</div>

<div id="ai-bot"><strong>ü§ñ Fedo AI:</strong><p id="aiMsg"></p></div>

<script>
    let topics = JSON.parse(localStorage.getItem('ff_topics')) || [{name:'–û–±—â–µ–µ', owner:'–°–∏—Å—Ç–µ–º–∞'}, {name:'–ú–µ–º—ã', owner:'–°–∏—Å—Ç–µ–º–∞'}];
    let posts = JSON.parse(localStorage.getItem('ff_posts')) || [];
    let user = JSON.parse(localStorage.getItem('ff_user')) || null;
    let curTopic = '–û–±—â–µ–µ', currentView = 'feed', curCode = null, tempImg = "";

    const GIFTS = { ring: { i: "üíç", p: 50, n: "–ö–æ–ª—å—Ü–æ" }, cake: { i: "üç∞", p: 30, n: "–¢–æ—Ä—Ç" }, home: { i: "üè°", p: 200, n: "–î–æ–º" } };
    const ACHIEVEMENTS = { first_post: { n: "–ü–∏—Å–∞—Ç–µ–ª—å", i: "‚úçÔ∏è" }, first_comm: { n: "–°–æ–±–µ—Å–µ–¥–Ω–∏–∫", i: "üí¨" }, liked: { n: "–õ—é–±–∏–º—á–∏–∫", i: "‚ù§Ô∏è" } };

    function init() {
        renderTopics(); render();
        if(user) {
            document.getElementById('authArea').style.display='none';
            document.getElementById('userArea').style.display='block';
            updateUserUI();
        }
    }

    function render() {
        document.getElementById('editor').style.display = (currentView === 'feed' && user) ? 'block' : 'none';
        if(currentView === 'feed') renderPosts();
        else if(currentView === 'profile') renderProfilePage();
        else if(currentView === 'chat') renderChatPage();
    }

    function showFeed() { currentView = 'feed'; render(); }
    function showProfile() { currentView = 'profile'; render(); }
    function showChat() { currentView = 'chat'; render(); }

    function renderTopics() {
        const l = document.getElementById('topicsList');
        l.innerHTML = topics.map(t => `
            <div class="nav-item ${t.name === curTopic ? 'active' : ''}" onclick="curTopic='${t.name}'; showFeed(); renderTopics();">
                # ${t.name} ${user && t.owner === user.name ? `<button onclick="deleteTopic(event, '${t.name}')" style="background:none; border:none; color:red; margin-left:auto;">√ó</button>` : ''}
            </div>`).join('');
    }

    function createTopic() {
        let n = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã:");
        if(n && !topics.find(x => x.name === n)) {
            topics.push({name: n, owner: user.name});
            localStorage.setItem('ff_topics', JSON.stringify(topics));
            renderTopics();
        }
    }

    function renderPosts() {
        const wall = document.getElementById('wall');
        const filtered = posts.filter(p => p.topic === curTopic);
        wall.innerHTML = filtered.map(p => {
            const isMy = user && p.author === user.name;
            const isL = user && user.likes && user.likes.includes(p.id);
            return `
            <div class="post">
                <div class="post-header">üë§ ${p.author} <span style="font-size:0.7rem; color:gray; margin-left:auto;">#${p.topic}</span></div>
                <div>${p.content}</div>
                ${p.img ? `<img src="${p.img}" class="post-img">`:''}
                <div style="margin-top:10px;">
                    <button onclick="like(${p.id})" style="border:none; background:none; cursor:pointer; color:${isL?'red':'#666'}">${isL?'‚ù§Ô∏è':'ü§ç'} ${p.likes}</button>
                    ${isMy ? `<button onclick="delPost(${p.id})" style="border:none; background:none; cursor:pointer; opacity:0.6;">üóëÔ∏è</button>` : ''}
                </div>
                <div style="margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                    ${(p.comments||[]).map(c=>`<div class="comment"><b>${c.u}:</b> ${c.t}</div>`).join('')}
                    ${user ? `<div style="display:flex; gap:5px; margin-top:5px;"><input id="ci-${p.id}" placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å (+10üí∞)..." style="font-size:0.8rem;"><button onclick="addComm(${p.id})" class="btn-main" style="width:auto; padding:2px 10px;">‚ûú</button></div>`:''}
                </div>
            </div>`;
        }).join('') || `<p style="text-align:center; color:gray;">–í —Ç–µ–º–µ #${curTopic} –ø–æ–∫–∞ –ø—É—Å—Ç–æ.</p>`;
    }

    function addPost() {
        let t = document.getElementById('postText').value.trim();
        if(!t && !tempImg) return;
        posts.unshift({ id:Date.now(), author:user.name, topic:curTopic, content:t, img:tempImg, likes:0, comments:[] });
        localStorage.setItem('ff_posts', JSON.stringify(posts));
        checkAch('first_post'); location.reload();
    }

    function addComm(id) {
        let inp = document.getElementById('ci-'+id); if(!inp.value) return;
        posts.find(x => x.id === id).comments.push({u: user.name, t: inp.value});
        user.coins = (user.coins || 0) + 10;
        localStorage.setItem('ff_posts', JSON.stringify(posts));
        localStorage.setItem('ff_user', JSON.stringify(user));
        aiSay("+10 Fedo-–∫–æ–∏–Ω–æ–≤ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!");
        updateUserUI(); renderPosts();
    }

    function like(id) {
        if(!user) return openAuth();
        let p = posts.find(x => x.id === id);
        if(!user.likes) user.likes = [];
        if(user.likes.includes(id)) { p.likes--; user.likes = user.likes.filter(x=>x!==id); }
        else { p.likes++; user.likes.push(id); checkAch('liked'); }
        localStorage.setItem('ff_posts', JSON.stringify(posts)); localStorage.setItem('ff_user', JSON.stringify(user)); renderPosts();
    }

    function renderProfilePage() {
        const wall = document.getElementById('wall');
        wall.innerHTML = `
            <div class="profile-card">
                <div style="font-size:3rem;">üë§</div>
                <h2>${user.name}</h2>
                <div class="coin-balance">üí∞ –ë–∞–ª–∞–Ω—Å: ${user.coins || 0}</div>
                
                ${user.family ? `
                    <div class="family-tag">üíñ –°–µ–º—å—è —Å: ${user.family} <button onclick="breakFam()" style="border:none; background:none; cursor:pointer;">√ó</button></div>
                    <div class="gift-grid">${(user.gifts || []).map(g => `<div class="gift-box">${g}</div>`).join('')}</div>
                    <div class="market">
                        ${Object.keys(GIFTS).map(k => `
                            <div class="market-item">
                                ${GIFTS[k].i}<br>${GIFTS[k].p}üí∞<br>
                                <button onclick="buyGift('${k}')" style="font-size:0.6rem; cursor:pointer;">–ö—É–ø–∏—Ç—å</button>
                            </div>`).join('')}
                    </div>
                ` : `<button onclick="createFam()" class="btn-main" style="margin-top:15px; background:var(--accent);">üíç –°–æ–∑–¥–∞—Ç—å —Å–µ–º—å—é</button>`}

                <div class="stats-row">
                    <div><b>${posts.filter(p=>p.author===user.name).length}</b><br>–ü–æ—Å—Ç–æ–≤</div>
                    <div><b>${user.achievements.length}</b><br>–ù–∞–≥—Ä–∞–¥</div>
                </div>
            </div>`;
    }

    function buyGift(k) {
        const g = GIFTS[k];
        if(user.coins < g.p) return aiSay("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
        user.coins -= g.p;
        if(!user.gifts) user.gifts = [];
        user.gifts.push(g.i);
        localStorage.setItem('ff_user', JSON.stringify(user));
        aiSay(`üéÅ –ö—É–ø–ª–µ–Ω–æ: ${g.n}!`); renderProfilePage(); updateUserUI();
    }

    function createFam() {
        let p = prompt("–ù–∏–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–∞:");
        if(p && p !== user.name) {
            user.family = p; localStorage.setItem('ff_user', JSON.stringify(user));
            aiSay(`üíû –°–µ–º—å—è —Å ${p} —Å–æ–∑–¥–∞–Ω–∞!`); renderProfilePage();
        }
    }

    function breakFam() { if(confirm("–†–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç—å —É–∑—ã?")) { user.family = null; user.gifts = []; localStorage.setItem('ff_user', JSON.stringify(user)); renderProfilePage(); } }

    function askCode() {
        let n = document.getElementById('regName').value; if(!n) return;
        curCode = Math.floor(1000 + Math.random()*9000);
        document.getElementById('aiInp').style.display='block';
        document.getElementById('authBtn').innerText='–í–æ–π—Ç–∏';
        document.getElementById('authBtn').onclick=confirmAuth;
        aiSay(`–ö–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è ${n}: ${curCode}`);
    }
    function confirmAuth() {
        if(document.getElementById('aiCodeInp').value == curCode) {
            user = { name: document.getElementById('regName').value, likes: [], achievements: [], coins: 0, gifts: [], family: null };
            localStorage.setItem('ff_user', JSON.stringify(user)); location.reload();
        }
    }

    function aiSay(m) {
        document.getElementById('ai-bot').style.display='block'; document.getElementById('aiMsg').innerText = m;
        setTimeout(() => document.getElementById('ai-bot').style.display='none', 6000);
    }

    function updateUserUI() {
        document.getElementById('uName').innerText = "üë§ " + user.name;
        document.getElementById('uCoins').innerText = "üí∞ " + (user.coins || 0);
    }

    function openAuth() { document.getElementById('authModal').style.display='flex'; }
    function logout() { localStorage.removeItem('ff_user'); location.reload(); }
    function prevImg() {
        let f = document.getElementById('fileInp').files[0];
        let r = new FileReader(); r.onloadend = () => { tempImg = r.result; document.getElementById('imgPreview').src=r.result; document.getElementById('imgPreview').style.display='block'; };
        if(f) r.readAsDataURL(f);
    }
    function checkAch(id) {
        if(user && !user.achievements.includes(id)) {
            user.achievements.push(id); localStorage.setItem('ff_user', JSON.stringify(user));
            aiSay(`üèÜ –ù–∞–≥—Ä–∞–¥–∞: ${id}!`);
        }
    }

    init();
</script>
</body>
</html>
